var xlvoPlayer={init:function(e){var t=JSON.parse(e),l=new RegExp("amp;","g");t.base_url=t.base_url.replace(l,""),this.config=t,this.ready=!0,xlvoPlayer.log(this.config),xlvoPlayer.config.use_mathjax&&MathJax&&MathJax.Hub.Config({"HTML-CSS":{scale:80}})},buttons_handled:!1,toolbar_loaded:!1,delay:5e3,counter:1,timeout:null,request_pending:!1,forced_update_interval:10,countdown_running:!1,config:{base_url:"",voter_count_element_id:"",lng:{player_voters_online:"Online",voting_confirm_reset:"Reset?"},status_running:-1,use_mathjax:!1,debug:!1,ilias_51:!0},player:{is_first:!0,is_last:!1,status:-1,active_voting_id:-1,show_results:!1,frozen:!0,votes:0,last_update:0,attendees:0,countdown:0,has_countdown:!1},run:function(){xlvoPlayer.log("running player"),this.registerElements(),this.getPlayerData()},handleFullScreen:function(){this.btn_close_fullscreen.parent().hide();var e=$("div.ilTabsContentOuter"),t=e[0],l=this;this.btn_start_fullscreen.click(function(){screenfull.enabled&&screenfull.request(t)}),this.btn_close_fullscreen.click(function(){screenfull.enabled&&screenfull.exit(t)}),screenfull.enabled&&document.addEventListener(screenfull.raw.fullscreenchange,function(){screenfull.isFullscreen?(e.addClass("xlvo-fullscreen"),l.btn_start_fullscreen.parent().hide(),l.btn_close_fullscreen.parent().show()):(e.removeClass("xlvo-fullscreen"),l.btn_start_fullscreen.parent().show(),l.btn_close_fullscreen.parent().hide())})},registerElements:function(){$(document).keydown(function(e){switch(e.which){case xlvoPlayer.config.keyboard.toggle_results:xlvoPlayer.callPlayer("toggle_results");break;case xlvoPlayer.config.keyboard.toggle_freeze:case 66:xlvoPlayer.callPlayer("toggle_freeze");break;case 33:case xlvoPlayer.config.keyboard.previous:xlvoPlayer.callPlayer("previous");break;case 34:case xlvoPlayer.config.keyboard.next:xlvoPlayer.callPlayer("next");break;default:return}e.preventDefault()}),this.btn_freeze=$("#btn-freeze"),this.btn_previous=$("#btn-previous"),this.btn_next=$("#btn-next"),this.btn_unfreeze=$("#btn-unfreeze"),xlvoPlayer.config.ilias_51?this.btn_unfreeze.closest(".btn-group").hide():this.btn_unfreeze.parent().hide(),this.btn_reset=$("#btn-reset"),this.btn_terminate=$("#btn-terminate"),this.btn_terminate.parent().hide(),this.btn_reset.parent().attr("disabled",!0),this.btn_hide_results=$("#btn-hide-results"),this.btn_show_results=$("#btn-show-results"),this.btn_toggle_pull=$("#btn-toggle-pull"),this.btn_show_results.parent().hide(),this.btn_start_fullscreen=$("#btn-start-fullscreen"),this.btn_close_fullscreen=$("#btn-close-fullscreen"),this.div_display_results=$("#xlvo-display-results"),this.toolbar=$("nav.ilToolbar"),this.toolbar.prepend('<div id="xlvo_player_loading"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>'),this.toolbar_loader=$("#xlvo_player_loading"),this.toolbar_loader.show(),this.btn_freeze.click(function(){return xlvoPlayer.callPlayer("toggle_freeze"),!1}),this.btn_unfreeze.click(function(){return xlvoPlayer.callPlayer("toggle_freeze"),!1}),this.btn_hide_results.click(function(){return xlvoPlayer.callPlayer("toggle_results"),!1}),this.btn_show_results.click(function(){return xlvoPlayer.callPlayer("toggle_results"),!1}),this.btn_reset.click(function(){return window.confirm(xlvoPlayer.config.lng.voting_confirm_reset)&&xlvoPlayer.callPlayer("reset"),!1}),this.btn_next.click(function(){return xlvoPlayer.callPlayer("next"),!1}),this.btn_previous.click(function(){return xlvoPlayer.callPlayer("previous"),!1}),this.btn_toggle_pull&&this.btn_toggle_pull.click(function(){xlvoPlayer.togglePull()}),this.handleFullScreen()},initElements:function(){this.player.frozen?(this.btn_freeze.parent().hide(),xlvoPlayer.config.ilias_51?this.btn_unfreeze.closest(".btn-group").show():this.btn_unfreeze.parent().show(),this.player.votes>0?this.btn_reset.removeAttr("disabled"):this.btn_reset.attr("disabled","disabled")):(xlvoPlayer.config.ilias_51?this.btn_unfreeze.closest(".btn-group").hide():this.btn_unfreeze.parent().hide(),this.btn_freeze.parent().show(),this.btn_reset.attr("disabled","disabled")),this.player.show_results?(this.btn_hide_results.parent().show(),this.btn_show_results.parent().hide(),this.div_display_results.show()):(this.btn_hide_results.parent().hide(),this.btn_show_results.parent().show(),this.div_display_results.hide()),this.player.is_last&&(this.btn_next.attr("disabled","disabled"),this.btn_previous.removeAttr("disabled")),this.player.is_first&&(this.btn_previous.attr("disabled","disabled"),this.btn_next.removeAttr("disabled")),this.player.is_last||this.player.is_first||(this.btn_next.removeAttr("disabled"),this.btn_previous.removeAttr("disabled")),this.player.is_last&&this.player.is_first&&(this.btn_next.attr("disabled","disabled"),this.btn_previous.attr("disabled","disabled"));var e=document.getElementById("xlvo-attendees");e.innerHTML=this.player.attendees+" Online"},startRequest:function(){xlvoPlayer.request_pending=!0},endRequest:function(){xlvoPlayer.request_pending=!1},isRequestPending:function(){return xlvoPlayer.request_pending},clearTimeout:function(){xlvoPlayer.timeout&&(xlvoPlayer.log("clear timeout"),clearTimeout(xlvoPlayer.timeout))},getPlayerData:function(){return xlvoPlayer.isRequestPending()?void xlvoPlayer.log("Pause getPlayerData due to running POST"):(xlvoPlayer.startRequest(),void $.get(xlvoPlayer.config.base_url,{cmd:"getPlayerData"}).done(function(e){if(xlvoPlayer.counter++,xlvoPlayer.counter>xlvoPlayer.forced_update_interval||e.player.last_update!=xlvoPlayer.player.last_update||e.player.show_results!=xlvoPlayer.player.show_results||e.player.status!=xlvoPlayer.player.status||e.player.active_voting_id!=xlvoPlayer.player.active_voting_id||xlvoPlayer.player.has_countdown){var t=e.player_html;$("#xlvo-display-player").replaceWith('<div id="xlvo-display-player">'+t+"</div>"),xlvoPlayer.config.use_mathjax&&MathJax&&(MathJax.Hub.Config({"HTML-CSS":{scale:80}}),MathJax.Hub.Queue(["Typeset",MathJax.Hub,"xlvo-display-player"])),xlvoPlayer.counter=0,xlvoPlayer.buttons_handled=!1}xlvoPlayer.player=e.player,xlvoPlayer.handleQuestionButtons(e.buttons_html),xlvoPlayer.initElements(),xlvoPlayer.timeout=setTimeout(xlvoPlayer.getPlayerData,xlvoPlayer.delay),xlvoPlayer.endRequest()}))},handleSwitch:function(){xlvoPlayer.buttons_handled=!1,xlvoPlayer.counter=99,xlvoPlayer.endRequest()},callPlayer:function(e,t){xlvoPlayer.isRequestPending()&&xlvoPlayer.log("There is already a request"),xlvoPlayer.startRequest(),xlvoPlayer.toolbar_loader.show();var t=t?t:{},r=$.extend({call:e},t);$.post(xlvoPlayer.config.base_url+"&cmd=apiCall",r).done(function(){xlvoPlayer.handleSwitch(),xlvoPlayer.getPlayerData()})},callButton:function(e,t){xlvoPlayer.isRequestPending()||(xlvoPlayer.startRequest(),xlvoPlayer.toolbar_loader.show(),this.log("call Button: "+e),$.post(xlvoPlayer.config.base_url+"&cmd=apiCall",{call:"button",button_id:e,button_data:t}).done(function(){}).fail(function(){}).always(function(){xlvoPlayer.handleSwitch(),xlvoPlayer.getPlayerData(),xlvoPlayer.endRequest()}))},open:function(e){return this.callPlayer("open",{xvi:e}),!1},updateAttendees:function(){xlvoPlayer.isRequestPending()||(xlvoPlayer.startRequest(),$.get(this.base_url,{cmd:"getAttendees"}).done(function(e){$("#xlvo-attendees").html(e+" Online"),xlvoPlayer.timeout=setTimeout(xlvoPlayer.updateAttendees,5e3),xlvoPlayer.endRequest()}))},handleStartButton:function(){var e=$(".xlvo-preview");e.disableSelection(),e.click(function(t){return xlvoPlayer.clearTimeout(),t.shiftKey?(window.location.href=e.attr("href")+"&preview=1&key=1",!1):!0})},handleQuestionButtons:function(e){if(xlvoPlayer.buttons_handled)return void this.log("buttons already handled for this question");var t=$("<div/>").html(e).contents(),l=t.find("ul.nav"),n=l.find(".btn").length,a=this.toolbar.find("ul.nav").last(),r=a.find("li#dynamic_sep");return 1>n||!e||""===e?(r.length>0&&(r.nextAll().remove(),r.remove()),xlvoPlayer.log("there are no custom buttons"),xlvoPlayer.log(e),xlvoPlayer.buttons_handled=!0,void xlvoPlayer.toolbar_loader.hide()):(xlvoPlayer.log("there are custom buttons!"),l.find(".btn").each(function(){$(this).addClass("xlvo_custom_button")}),r.length>0?(xlvoPlayer.log("removing everything after separator"),r.nextAll().remove()):(xlvoPlayer.log("appending separator"),a.append("<li id='dynamic_sep' class='ilToolbarSeparator hidden-xs'></li>")),a.append(l.html()),a.find(".xlvo_custom_button").on("click",function(){xlvoPlayer.callButton($(this).attr("id"),!0)}),xlvoPlayer.toolbar_loader.hide(),void(xlvoPlayer.buttons_handled=!0))},countdown:function(e){xlvoPlayer.countdown_running=!0,xlvoPlayer.log("Countdown started: "+e),xlvoPlayer.callPlayer("countdown",{seconds:e})},togglePull:function(){xlvoPlayer.timeout?(alert("Pull stopped"),xlvoPlayer.clearTimeout(),xlvoPlayer.timeout=!1):(alert("Pull started"),xlvoPlayer.getPlayerData())},log:function(e){this.config.debug&&console.log(e)},debug:function(){this.config.debug=!0},stop:function(){this.config.debug=!1}};