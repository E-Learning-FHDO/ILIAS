var xlvoVoter={init:function(o){var e=JSON.parse(o),t=new RegExp("amp;","g");e.base_url=e.base_url.replace(t,""),this.config=e,this.ready=!0,xlvoVoter.config.use_mathjax&&MathJax&&MathJax.Hub.Config({"HTML-CSS":{scale:80}})},config:{base_url:"",cmd_voting_data:"",lng:{player_seconds:"s"},debug:!1},player:{frozen:!0,active_voting_id:0,status:-1,countdown:0,has_countdown:!1,countdown_classname:""},delay:3000,counter:0,forced_update:300,timeout:null,run:function(){this.loadVotingData(),this.initElements()},initElements:function(){this.countdown_element=$("#xlvo_countdown"),this.player_element=$("#xlvo_voter_player")},loadVotingData:function(){$.get(xlvoVoter.config.base_url,{cmd:"getVotingData"}).done(function(o){xlvoVoter.log(o);var e=xlvoVoter.player.active_voting_id!=o.active_voting_id,t=xlvoVoter.player.status!=o.status,n=xlvoVoter.counter>xlvoVoter.forced_update,l=xlvoVoter.player.frozen!=o.frozen;xlvoVoter.player=o,t||e||n||l?xlvoVoter.replaceHTML(xlvoVoter.handleCountdown()):xlvoVoter.handleCountdown(),xlvoVoter.timeout=setTimeout(xlvoVoter.loadVotingData,xlvoVoter.delay),xlvoVoter.counter++}).fail(function(){xlvoVoter.timeout=setTimeout(xlvoVoter.loadVotingData,xlvoVoter.delay)})},replaceHTML:function(o){xlvoVoter.log("replace"),o=o?o:function(){},$.get(xlvoVoter.config.base_url,{cmd:"getHTML"}).done(function(e){xlvoVoter.player_element.replaceWith('<div id="xlvo_voter_player">'+e+"</div>"),xlvoVoter.config.use_mathjax&&MathJax&&MathJax.Hub.Queue(["Typeset",MathJax.Hub,"xlvo_voter_player"]),xlvoVoter.counter=0,xlvoVoter.player_element=$("#xlvo_voter_player"),xlvoVoter.countdown_element=$("#xlvo_countdown"),o()})},handleCountdown:function(){xlvoVoter.player.has_countdown?(xlvoVoter.log("has countdown: "+(xlvoVoter.player.has_countdown?"yes, "+xlvoVoter.player.countdown:"no")),xlvoVoter.countdown_element.removeClass(),xlvoVoter.countdown_element.text(xlvoVoter.player.countdown.toString()+" "+xlvoVoter.config.lng.player_seconds),xlvoVoter.countdown_element.show(),xlvoVoter.countdown_element.addClass("label label-cd-"+xlvoVoter.player.countdown_classname)):(xlvoVoter.countdown_element.removeClass(),xlvoVoter.countdown_element.hide())},log:function(o){if(xlvoVoter.config.debug){{var e=new Error;e.stack}console.log(o)}}};
